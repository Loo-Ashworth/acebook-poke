<form
  id="new-post-form"
  action="/posts"
  method="post"
  enctype="multipart/form-data"
>
  <div class="form-message">
    <label for="message">Message: </label>
    <textarea
      id="message"
      class="form-control custom-input"
      name="message"
    ></textarea>
  </div>

  <div class="form-image">
    <label for="image">Image:</label>
    <input
      type="file"
      class="form-control custom-input"
      id="image"
      name="image"
    />
  </div>

  {{#if error}}
    <p><strong>Error:</strong> {{error}}</p>
  {{/if}}

  <div class="form-submit">
    <input
      type="submit"
      class="btn btn-primary btn-block"
      id="#new-post-form"
    >Submit</input>
  </div>
</form>

<script>
  document.getElementById('new-post-form').addEventListener('submit', (event) => {
    event.preventDefault();

    const formData = new FormData(event.target);
    console.log('hello')
    fetch(event.target.action, {
      method: event.target.method,
      headers: {
        "Accept": "application/json"
      },
      body: formData
    }).then(response => {
      if(response.ok) {
        return response.json();
      } else {
        throw new Error('Error: ' + response.statusText);
      }
    }).then(data => {
      console.log(data);
      const newPost = document.createElement('li');
      newPost.classList.add('post-item');
      newPost.innerHTML = data.html;
      const postsList = document.querySelector('.posts');
      postsList.insertAdjacentElement('afterbegin', newPost);
    }).catch(error => {
      console.error(error);
    });
  });
</script>
